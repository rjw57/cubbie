{% extends "base.html" %}
{% block title %}Sign into cubbie{% endblock %}
{% block head %}
    {{ super() }}
    <meta name="google-signin-clientid" content="{{ google.client_id }}" />
    <meta name="google-signin-scope" content="profile" />
    <meta name="google-signin-cookiepolicy" content="single_host_origin" />
    <meta name="google-signin-callback" content="signinCallback" />
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-md-4 col-md-offset-4">
            <div class="login-panel panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Please Sign In</h3>
                </div>
                <div class="panel-body">
                    <div id="gSignInWrapper">
                        <button id="gplusButton" disabled class="btn btn-lg btn-success btn-block">
                            Sign in with Google
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}

<!-- Google sign in API -->
<script src="https://apis.google.com/js/client:platform.js?onload=gapiLoaded" async defer></script>

<script>
function gapiLoaded() {
    gapi.signin.render('gplusButton');
    document.getElementById('gplusButton').disabled = false;
}

function signinCallback(authResult) {
    var connectUrl = '{{ google.connect_url }}';
    var body;

    if(authResult.access_token) {
        // Request our own JWT-based access token.
        body = { access_token: authResult.access_token };
        $.ajax({
            url: connectUrl,
            type: 'POST',
            data: JSON.stringify(body),
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            success: function(response) {
                console.log('resp:', response);
            },
        });
    }
}
</script>
{% endblock %}
